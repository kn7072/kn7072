[источник](https://wiki.merionet.ru/articles/nastrojka-dhcp-na-oborudovanii-cisco?ysclid=mlax07tz75162618888)

- [ Настройка DHCP на оборудовании Cisco](#link_1)
  - [ Исключение адресов IPv4](#link_2)
  - [ Настройка DHCP пула](#link_3)
  - [ Ретрансляция DHCP (DHCP Relay)](#link_4)
  - [ Настройка роутера как DHCP клиента](#link_5)

# Настройка DHCP на оборудовании Cisco <a name="link_1"></a>

Друг, наша предыдущая статья была посвящена рассказу о том, [что из себя представляет протокол DHCP (Dynamic Host Configuration Protocol)](https://wiki.merionet.ru/seti/11/vse-chto-vam-nuzhno-znat-pro-dhcp/). Сегодня мы расскажем, как его настроить на оборудовании **Cisco**.

Маршрутизатор Cisco, работающий под управлением программного обеспечения **Cisco IOS**, может быть настроен на работу в качестве DHCP сервера. Сервер назначает и управляет адресами IPv4 из указанных пулов адресов в маршрутизаторе для DHCP клиентов.

---

## Исключение адресов IPv4 <a name="link_2"></a>

Маршрутизатор, работающий как DHCP сервер, назначает все адреса IPv4 в диапазоне (пуле), если не настроен на исключение определенных адресов. Как правило, некоторые IP адреса из пула принадлежат сетевым устройствам, таким как маршрутизаторы, сервера или принтеры, которым требуются статические адреса, поэтому эти адреса не должны назначаться другим устройствам. Чтобы их исключить, используется команда **ip dhcp excluded-address**. При помощи этой команды можно исключить как один единственный адрес, так и диапазон адресов, указав из него первый и последний.

Рассмотрим на примере, в котором исключим из раздачи адрес 192.168.1.254 и адреса с 192.168.1.1 по 192.168.1.9

```
Router(config)# ip dhcp excluded-address 192.168.1.254
Router(config)# ip dhcp excluded-address 192.168.1.1 192.168.1.9
```

---

## Настройка DHCP пула <a name="link_3"></a>

Настройка DHCP сервера включает в себя определение пула адресов, которые будут раздаваться. Для создания пула используется команда **ip dhcp pool [название_пула]**. После этого необходимо ввести две обязательные команды – **network [адрес_сети][маска/длина_префикса]** для указания сети из которой будут раздаваться адреса и **default-router[адрес_default_gateway]** для указания шлюза по умолчанию (можно ввести до 8 адресов).

Также можно использовать дополнительные команды – например, указать DNS сервер (команда **dns-server [адрес]**), доменное имя (команда **domain-name [домен]**), NetBIOS WINS сервер (команда **netbios-name-server[адрес]**), а так же время аренды адреса (команда **lease [количество_дней_часов_минут]**, сначала указываются дни, затем через пробел часы, а затем минуты). По умолчанию время аренды выставляется 1 день.

```
Router(config)# ip dhcp pool POOL-1
Router(dhcp-config)# network 192.168.1.0 255.255.255.0
Router(dhcp-config)# default-router 192.168.1.1
Router(dhcp-config)# dns-server 192.168.1.2
Router(dhcp-config)# domain-name merionet.ru
Router(dhcp-config)# lease 2
```

Чтобы выполнить проверку можно использовать команду **show ip dhcp binding**, которая показывает список всех IP адресов и сопоставленных с ними MAC адресов, которые были выданы DHCP сервером. Также есть команда **show ip dhcp server statistics**, используя которую можно увидеть статистику DHCP сервера, включая информацию об отправленных и полученных DHCP сообщениях. Ну и если клиентом является ПК с ОС Windows, то информацию можно посмотреть через командную строку, введя команду **ipconfig /all**, а для пользователей Linux подойдет команда **ifconfig**.

---

## Ретрансляция DHCP (DHCP Relay) <a name="link_4"></a>

В сложной иерархической сети серверы обычно находятся не в той же сети, что и клиенты. В результате если DHCP сервер находится в другой сети, то до него не смогут доходить запросы от клиентов, поскольку маршрутизаторы не пересылают широковещательные сообщения. Чтобы решить эту проблему нужно воспользоваться командной **ip helper-address [адрес_DHCP-сервера]**, которую нужно ввести на маршрутизаторе в режиме конфигурации интерфейса, чтобы он перенаправлял broadcast сообщения от DHCP клиентов уже в виде unicast к DHCP серверу, находящемуся в другой сети.

```
Router_2(config)# interface g0/0
Router_2(config-if)# ip helper-address 192.168.1.1
```

---

## Настройка роутера как DHCP клиента <a name="link_5"></a>

Иногда роутер сам должен получить IP адрес по DHCP, например от интернет-провайдера. Для этого нужно в режиме конфигурации интерфейса ввести команду **ip address dhcp**, после чего интерфейс будет пытаться получить адрес от DHCP сервера.

```
Router_3(config)# interface g0/0
Router_3(config-if)# ip address dhcp
```

[дополнительные ссылки](https://wiki.merionet.ru/search/?search=DHCP%20на%20Cisco)
