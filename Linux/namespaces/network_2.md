[источник](https://ru.linux-console.net/?p=15130)

- [ Как использовать сетевое пространство имен Linux](#link_1)
  - [ Добавление сетевого пространства имен Linux:](#link_2)
  - [ Создание петлевого интерфейса для пространства имен:](#link_3)
  - [ Добавление сетевых интерфейсов в ваше пространство имен:](#link_4)
  - [ Удаление сетевого пространства имен Linux:](#link_5)
  - [ Заключение:](#link_6)

# Как использовать сетевое пространство имен Linux <a name="link_1"></a>

---

Сетевые пространства имен Linux — это функция ядра Linux, позволяющая изолировать сетевые среды посредством виртуализации. Например, используя сетевые пространства имен, вы можете создавать отдельные сетевые интерфейсы и таблицы маршрутизации, которые изолированы от остальной системы и работают независимо.

Чтобы легко понять пространства имен, стоит сказать, что пространства имен Linux являются основой контейнерных технологий, таких как Docker или Kubernetes.

На данный момент Linux включает 6 типов пространств имен: pid, net, uts, mnt, ipc и user. В этом руководстве основное внимание уделяется сетевым пространствам имен Linux.

Если вы наберете команду lsns, она отобразит все существующие пространства имен в вашей системе, как показано на изображении ниже.

lsns

![](network_2_images/80bcde6fd1bdb22813ddb9ba5559ad4e_MD5.avif)

**Примечание.** Пространство имен, используемое в этом руководстве, называется linux-console; замените его своим именем пространства имен.

## Добавление сетевого пространства имен Linux: <a name="link_2"></a>

Управление сетевыми пространствами имен осуществляется с помощью команды ip netns, за которой следуют соответствующие параметры.

Чтобы создать сетевое пространство имен в Linux, вам необходимо выполнить команду ip, за которой следует параметр netns (сетевое пространство имен), параметр добавления и имя нового пространства имен, как показано на следующем снимке экрана. Затем можно запустить команду ip netns, чтобы отобразить только существующие сетевые пространства имен. Не забудьте заменить linux-console именем вашего пространства имен.

```bash
ip netns add linux-console
ip netns
```

![](network_2_images/bb5bcda916316a3fbdecd79ad897feb0_MD5.avif)

Как видите, было создано новое пространство имен linux-console.

Сетевые пространства имен имеют свои собственные интерфейсы, таблицы маршрутизации, петлевой интерфейс, правила iptables и т. д. Вам необходимо создать эти ресурсы для своего пространства имен.

## Создание петлевого интерфейса для пространства имен: <a name="link_3"></a>

Для запуска команд в сетевом пространстве имен используется следующий синтаксис.

```bash
ip netns exec <NameSpace> <command>
```

По умолчанию петлевой интерфейс отключен. Вам нужно выполнить следующую команду; как объяснялось ранее, приведенная ниже команда выполняет команду ip link set dev lo up в выбранном пространстве имен.

```bash
ip netns exec linux-console ip link set dev lo up
```

![](network_2_images/be4c49a31154bca49f0cf46628e06385_MD5.avif)

Вы можете проверить, правильно ли был добавлен ваш петлевой интерфейс, выполнив следующую команду:

```bash
ip netns exec linux-console ip address
```

![](network_2_images/143e72e00b05c70523fa2b8b29d31134_MD5.avif)

Вы также можете пропинговать петлевой интерфейс вашего пространства имен, чтобы протестировать его, как показано ниже.

```bash
ip netns exec linux-console ping 127.0.0.1
```

![](network_2_images/fc9139fccb9a790ebfd76266ae6e96d4_MD5.avif)

## Добавление сетевых интерфейсов в ваше пространство имен: <a name="link_4"></a>

Вы можете связать аппаратную сетевую карту с вашим пространством имен или добавить виртуальные сетевые устройства. Добавляя виртуальные сетевые интерфейсы, вы можете разрешить подключение между различными пространствами имен. Виртуальные сетевые устройства называются veth (Virtual Ethernet Device).

Чтобы создать виртуальное сетевое устройство Ethernet, выполните следующую команду, где enp2s0 — это новое устройство, а v-peer1 — его произвольное имя, замените его своим.

```bash
ip link add v-enp2s0 type veth peer name v-eth0
```

![](network_2_images/b09a0722bbb5ba0e3e1c3efd7fb59a1a_MD5.avif)

Теперь назначьте виртуальное устройство вашему пространству имен, выполнив приведенную ниже команду.

```bash
ip link set v-eth0 netns linux-console
```

![](network_2_images/0f0b1f918a1bac737435fcc46b7f4e1e_MD5.avif)

Назначьте IP-адрес новому сетевому устройству, как показано ниже.

```bash
ip -n linux-console addr add 10.0.1.0/24 dev v-eth0
```

![](network_2_images/0d73abfed2164540c6e133bf97c91d58_MD5.avif)

По умолчанию сетевое устройство отключено; вам нужно настроить его. Чтобы настроить виртуальное сетевое устройство, выполните следующую команду.

```bash
ip -n linux-console link set v-eth0 up
```

![](network_2_images/446f18e4dd66bea3d7e8416c2d1cc66a_MD5.avif)

Как вы можете видеть на скриншоте ниже, виртуальное устройство было добавлено правильно.

```bash
ip netns exec linux-console sudo ifconfig
```

![](network_2_images/11158c4940d2d62ebe43707d75d48c0f_MD5.avif)

В приведенном ниже примере показано, как назначить физическую сетевую карту вашему сетевому пространству имен. В этом случае физической сетевой картой является enp2s0.

```bash
ip link set dev enp2s0 netns linux-console
```

![](network_2_images/b9873af8fe41cd0225b2b14af6cadf02_MD5.avif)

Как вы можете видеть, запустив пример ниже, сетевая карта была добавлена правильно. Вы можете назначить IP-адрес, используя те же команды, которые были описаны ранее.

```bash
ip netns exec linux-console sudo ifconfig
```

![](network_2_images/de49fae013c96d1b492b31b073b82a7d_MD5.avif)

Как объяснялось ранее, каждое пространство имен имеет свою собственную таблицу маршрутов, IP-адрес и многое другое, включая собственные правила брандмауэра. Добавить правила брандмауэра в ваше пространство имен очень просто; просто запустите команды после ip netns exec linux-console, как показано ниже. В приведенном ниже примере перечислены политики iptables, если они существуют.

```bash
ip netns exec linux-console sudo iptables -L
```

![](network_2_images/ca07eb951a2e110971b3d5c83314addb_MD5.avif)

В следующем примере показано то же самое, но с использованием UFW (несложный брандмауэр) вместо iptables. В этом случае брандмауэр считается отключенным.

```bash
ip netns exec linux-console sudo ufw status
```

![](network_2_images/a04820ffa9b41545393042bffc1a51ad_MD5.avif)

## Удаление сетевого пространства имен Linux: <a name="link_5"></a>

Удалить сетевые пространства имен довольно просто, как и при их добавлении.

Чтобы удалить пространство имен, выполните приведенную ниже команду, заменив linux-console своим пространством имен.

```bash
ip netns del linux-console
```

![](network_2_images/278f49fea79b0e26c72d7a04afe5a0f5_MD5.avif)

Как видите, после запуска ip netns пространство имен сети не отображалось; он был успешно удален.

## Заключение: <a name="link_6"></a>

Пространства имен Linux — отличный способ изолировать процессы, файловые системы, сети и многое другое. Эта функциональность позволяет нам выполнять экземпляры независимо. Это чрезвычайно полезно в целях безопасности. Пространства имен — это контейнеры, содержимое которых полностью изолировано от остальной системы, в том числе от других пространств имен. Таким образом, мы можем запускать разные службы в разных контейнерах. Если пространство имен будет скомпрометировано в результате атаки, остальная часть системы останется в безопасности. Используя пространства имен Linux, вы можете предложить нескольким клиентам их окружение; эта функция также отлично подходит для целей тестирования или для запуска программного обеспечения, происхождение которого вызывает подозрения; в случае выполнения вредоносного кода будет затронуто только ваше пространство имен, что сделает ваше устройство безопасным.

Я надеюсь, что это руководство по пространствам имен Linux было полезным. Продолжайте следовать Linux Hint, чтобы получить больше советов и руководств по Linux.
