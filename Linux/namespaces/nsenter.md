[источник](https://ru.linux-console.net/?p=14334)

- [ Работа с командой nsenter Linux](#link_1)
  - [ Как проверить пространства имен Linux с помощью nsenter](#link_2)
  - [ Что такое контейнеры Linux?](#link_3)
  - [ Использование nsenter с пространствами имен Linux](#link_4)

# Работа с командой nsenter Linux <a name="link_1"></a>

---

Одним из способов инкапсуляции хост-системы при запуске различных процессов является использование **контейнеров**. Для DevOps контейнеры стали способом развертывания приложений, поскольку они гарантируют безопасность и изоляцию всей системы и ресурсов. Изоляция системных ресурсов работает через **пространства имен** Linux. Контейнер работает независимо и не может получить доступ к ресурсам хоста.

Ядро может выделять и ограничивать ресурсы, к которым работающие процессы могут обращаться через пространства имен. Пространства имен создают изоляцию, а контейнеры только просматривают процессы. Чтобы легко работать с контейнерами и пространствами имен, требуется команда Linux **nsenter**, и мы увидим, как использовать nsenter для проверки и выполнения программ в пространствах имен.

## Как проверить пространства имен Linux с помощью nsenter <a name="link_2"></a>

Прежде чем мы углубимся в использование nsenter, нам нужно понять контейнеры и пространства имен Linux.

## Что такое контейнеры Linux? <a name="link_3"></a>

С развитием технологий потребность в разработке более масштабируемых и безопасных приложений увеличила потребность в использовании контейнеров. Контейнеры Linux лучше всего можно назвать технологией, которая позволяет упаковывать и изолировать приложения и ресурсы в их среде выполнения, вдали от системы. Кроме того, вы также можете создавать контейнеры, содержащие пространства имен для различных процессов в вашей системе Linux, используя различные инструменты, такие как **podman** или **docker**.

В этом примере мы создадим новый контейнер с помощью докера, как показано на изображении ниже.

![](nsenter_images/a4e2eefbbe9784e165f72a64b3caebbb_MD5.avif)

Выйдите из контейнера и перечислите доступные контейнеры из хост-системы. Вы заметите, что созданный нами контейнер отображается в списке, включая его идентификатор контейнера.

```bash
sudo docker ps -l
```

![](nsenter_images/54d0ed2f7e7e4cdf71040a8a52197076_MD5.avif)

В качестве альтернативы, если вы используете **podman**, Red Hat предлагает контейнер в своем каталоге, к которому вы можете получить доступ с помощью приведенной ниже команды.

```bash
podman run --name namespace-demo -it registry.access.redhat.com/ubi8/ubi /bin/bash
```

После создания контейнера укажите идентификатор процесса контейнера, созданного с помощью приведенной ниже команды.

```bash
runc list
```

В выводе вы должны отметить идентификатор процесса. В нашем случае это идентификатор **39782**.

![](nsenter_images/1b8962f0378b9640c8df1cd9ff737d60_MD5.avif)

Используя приведенный выше идентификатор процесса, вы можете получить связанные с ним пространства имен с помощью **lsns** или **nsenter**.

Чтобы использовать **lsns**, используйте приведенный ниже синтаксис.

```bash
lsns -p <process-id>
```

![](nsenter_images/b15abb3c4547352caee63e7cfade89a8_MD5.avif)

В отличие от lsns, nsenter предлагает больше возможностей, что дает вам больший контроль.

## Использование nsenter с пространствами имен Linux <a name="link_4"></a>

Некоторые из общих параметров, которые вы можете использовать с nsenter, включают:

**1. -t:** этот флаг указывает идентификатор целевого процесса.

**2. -u:** используется для ввода пространства имен процесса, и если пространство имен не введено, будет использоваться пространство имен целевого процесса.

Например, чтобы получить имя хоста пространства имен с идентификатором 39782, команда будет выглядеть так:

```bash
nsenter -t 39782 -u hostname
```

![](nsenter_images/8d5ff1c96ed77600b1f02cf2f93edafd_MD5.avif)

**3. -a:** используется для ввода всех доступных пространств имен. В нашем случае у нас есть только один. Если мы запустим команду ниже, вы заметите, что мы находимся внутри контейнера.

![](nsenter_images/3413b9f62fbf77e21d5135e1b336a312_MD5.avif)

Вы можете выйти, набрав **exit**.

**4. -n:** флаг используется для входа в сетевое пространство имен. Просматривается только сетевая информация для данного пространства имен.

![](nsenter_images/2c6a02013ee5bcad508161e042d6914c_MD5.avif)

Если бы вы просмотрели одни и те же сведения о сети из всей системы, вы бы заметили наличие изоляции.

![](nsenter_images/9e45fb9b6dc07c3c01cf1cfffcaf821b_MD5.avif)

Изоляция распространяется на **IP-маршрут**, и мы также можем получить IP-маршрут для пространства имен с помощью приведенной ниже команды.

```bash
nsenter -t 39782 -n ip route
```

![](nsenter_images/463c4125a9995eff7f19e245db082b79_MD5.avif)

На изображении выше вы можете заметить, что первый вывод относится к пространству имен данного целевого идентификатора процесса, а второй вывод — это ip-маршрут для всей системы.

**5. -p:** с помощью nsenter вы также можете ввести пространство имен PID, используя флаг **-p**. Чтобы это работало, внутри контейнера должны быть установлены команды **top** или **ps**.

Если вы создали контейнер **podman**, используйте приведенную ниже команду для установки пакета **procps-ng**, который устанавливает top и ps для просмотра запущенных в данный момент процессов с помощью **ps -ef** команда Linux.

```bash
yum install procps-ng
```

![](nsenter_images/303d64d493a60790f451e3d0591dac40_MD5.avif)

Теперь вы можете ввести пространство имен PID, используя приведенную ниже команду.

```bash
nsenter -t 39782 -p -r ps -ef
```

**-r** задает корневой каталог, и если он не указан, как в приведенной ниже команде, он использует идентификатор целевого процесса.

![](nsenter_images/9cf3bedd9d818e951f905b1f31c17672_MD5.avif)

Вывод дает текущий процесс в контейнере.
